<div class="container margin-header gris">
    <h1 class="mt-3">Perfil</h1>

    <div *ngIf="auth.user">
        <img [src]="auth.user.photoURL" width="150px">
        <input id="file" type="file" (change)="perfilService.updateProfileImage($event)" accept=".png,.jpg" />

        <!--Nombre-->
        <p class="mt-3">
            Name: {{auth.user.displayName}}
            <button (click)="enableDisableUpdateName(1)" class="btn btn-primary ml-2">
                Editar
            </button>
        </p>
        <!--Formulario cambiar nombre-->
        <form *ngIf="enabledName" [formGroup]="name" (ngSubmit)="updateName()">
            <!--Nombre-->
            <mat-form-field appearance="outline" class="w-100">
                <mat-label>Introduce tu nuevo nombre</mat-label>
                <input id="name" matInput formControlName="name">
                <mat-icon matSuffix>perm_identity</mat-icon>
                <!--Validación nombre-->
                <mat-error *ngIf="formName.name.errors && formName.name.errors.required">
                    Este campo es <strong>obligatorio.</strong>
                </mat-error>
                <mat-error *ngIf="formName.name.errors && formName.name.errors.minlength">
                    El nombre debe tener al menos
                    <strong>{{formName.name.errors.minlength.requiredLength}}</strong> carácteres.
                </mat-error>
            </mat-form-field>
            <!--Submit cambiar nombre-->
            <button type="submit" class="btn btn-primary ml-2">
                Cambiar nombre
            </button>
            <!--Submit cancelar-->
            <button type="button" (click)="enableDisableUpdateName(2)" class="btn btn-primary ml-2">
                Cancelar
            </button>
        </form>

        <p>Status: {{auth.user.status}}</p>
        <p>Coins: {{auth.user.coins}}</p>
        <p>Mail: {{auth.user.email}}</p>

        <!--En caso de que se hayan registrado con email y contraseña-->
        <ng-container *ngIf="auth.providerId">
            <div *ngIf="auth.providerId == 'password'" class="mt-4">
                <button class="btn btn-primary" (click)="enableDisableUpdateEmail(1)">Cambiar email</button>
                <button class="btn btn-primary ml-2" (click)="enableDisableUpdatePass(1)">Cambiar
                    contraseña</button>
            </div>
        </ng-container>

        <!--Mensaje error-->
        <div *ngIf="msg" class="alert alert-danger mt-3" role="alert">
            {{ msg }}
        </div>

        <!--Formulario email-->
        <form *ngIf="enabledEmail" [formGroup]="email" (ngSubmit)="updateEmail()" class="mt-2">
             <!--Email-->
             <mat-form-field appearance="outline" class="w-100">
                <mat-label>Introduce tu nuevo email</mat-label>
                <input id="email" matInput formControlName="email">
                <mat-icon matSuffix>perm_identity</mat-icon>
                <!--Validación email-->
                <mat-error *ngIf="formEmail.email.errors && formEmail.email.errors.required">
                    Este campo es <strong>obligatorio.</strong>
                </mat-error>
                <mat-error *ngIf="formEmail.email.errors && formEmail.email.errors.email">
                    Introduce un email válido
                </mat-error>
            </mat-form-field>
            <button type="submit" class="btn btn-primary">Cambiar</button>
            <button type="button" class="btn btn-primary ml-2" (click)="enableDisableUpdateEmail(2)">Cancelar</button>
        </form>

        <!--Formulario contraseña-->
        <form *ngIf="enabledPass" [formGroup]="pass" (ngSubmit)="updatePass()" class="mt-2">
            <!--Password-->
            <mat-form-field appearance="outline" class="w-50 pr-1">
                <mat-label>Crea una contraseña</mat-label>
                <input matInput [type]="hide1 ? 'password' : 'text'" formControlName="password">
                <button type="button" mat-icon-button matSuffix (click)="hide1 = !hide1"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide1">
                    <mat-icon>{{hide1 ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
                <!--Validación contraseña-->
                <mat-error *ngIf="formPass.password.errors && formPass.password.errors.required">
                    Este campo es <strong>obligatorio.</strong>
                </mat-error>
                <mat-error *ngIf="formPass.password.errors && formPass.password.errors.minlength">
                    La contraseña debe tener como mínimo
                    <strong>{{formPass.password.errors.minlength.requiredLength}} carácteres.</strong>
                </mat-error>
            </mat-form-field>
            <!--Confirmación Password-->
            <mat-form-field appearance="outline" class="w-50 pl-1">
                <mat-label>Repite la contraseña</mat-label>
                <input matInput [type]="hide2 ? 'password' : 'text'" formControlName="confirmPassword"
                    pattern="{{pass.value.password}}">
                <button type="button" mat-icon-button matSuffix (click)="hide2 = !hide2"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide2">
                    <mat-icon>{{hide2 ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>
                <!--Validación confirmación contraseña-->
                <mat-error *ngIf="formPass.confirmPassword.errors && formPass.confirmPassword.errors.required">
                    Este campo es <strong>obligatorio.</strong>
                </mat-error>
                <mat-error *ngIf="formPass.confirmPassword.errors && formPass.confirmPassword.errors.pattern">
                    La contraseñas <strong>no coinciden</strong>
                </mat-error>
            </mat-form-field>
            
            <button type="submit" class="btn btn-primary">Cambiar</button>
            <button type="button" class="btn btn-primary ml-2" (click)="enableDisableUpdatePass(2)">Cancelar</button>
        </form>


    </div>

</div>