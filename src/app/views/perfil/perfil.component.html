<div class="container margin-header gris">
    <div class="row">
        <!--Información perfil-->
        <div class="col-12 text-center" *ngIf="auth.user">
            <a class="ml-5" href="{{auth.user.photoURL}}" target="_blank">
                <img [src]="auth.user.photoURL" width="150px" height="150px" class="rounded-circle mt-4">
            </a>
            <button (click)="openFileSelection()" mat-mini-fab class="ml-2 btn-style edit">
                <mat-icon>mode_edit</mat-icon>
            </button>

            <input class="d-none" id="file" type="file" (change)="perfilService.updateProfileImage($event)"
                accept=".png,.jpg" />

            <!--Nombre-->
            <div class="mt-3">
                <h1 class="text-white">{{auth.user.displayName}}</h1>
                <p class="m-0">{{auth.user.coins}} monedas</p>
                <p>{{auth.user.email}}</p>
            </div>


            <button (click)="enableDisableUpdateName(1)" class="btn btn-primary mr-2">
                Cambiar nombre
            </button>

            <!--En caso de que se hayan registrado con email y contraseña-->
            <ng-container *ngIf="auth.providerId">
                <ng-container *ngIf="auth.providerId == 'password'">
                    <div ngbDropdown class="d-inline-block">
                        <button class="btn btn-primary" id="dropdownBasic1" ngbDropdownToggle>
                            Cambiar credenciales
                        </button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                            <button (click)="enableDisableUpdateEmail(1)" ngbDropdownItem class="btn btn-secondary">
                                Correo electrónico
                            </button>
                            <button (click)="enableDisableUpdatePass(1)" ngbDropdownItem class="btn btn-secondary">
                                Contraseña
                            </button>
                        </div>
                    </div>
                </ng-container>
            </ng-container>

            <!--Formulario cambiar nombre-->
            <form id="formName" *ngIf="enabledName" class="mt-4" [formGroup]="name" (ngSubmit)="updateName()">
                <!--Nombre-->
                <mat-form-field appearance="outline" class="w-50">
                    <mat-label class="gris">Introduce tu nuevo nombre</mat-label>
                    <input id="name" matInput formControlName="name">
                    <!--Validación nombre-->
                    <mat-error *ngIf="formName.name.errors && formName.name.errors.required">
                        Este campo es <strong>obligatorio.</strong>
                    </mat-error>
                    <mat-error *ngIf="formName.name.errors && formName.name.errors.minlength">
                        El nombre debe tener al menos
                        <strong>{{formName.name.errors.minlength.requiredLength}}</strong> carácteres.
                    </mat-error>
                </mat-form-field>

                <!--Submit cambiar nombre-->
                <button type="submit" class="btn btn-primary ml-2">
                    Confirmar
                </button>
                <!--Submit cancelar-->
                <button type="button" (click)="enableDisableUpdateName(2)" class="btn btn-outline-primary ml-2">
                    Cancelar
                </button>
            </form>


            <!--Mensaje error-->
            <div *ngIf="msg" class="alert alert-danger mt-3" role="alert">
                {{ msg }}
            </div>

            <!--Formulario email-->
            <form *ngIf="enabledEmail" [formGroup]="email" (ngSubmit)="updateEmail()" class="mt-4">
                <!--Email-->
                <mat-form-field appearance="outline" class="w-50">
                    <mat-label class="gris">Introduce tu nuevo email</mat-label>
                    <input id="email" matInput formControlName="email">
                    <!--Validación email-->
                    <mat-error *ngIf="formEmail.email.errors && formEmail.email.errors.required">
                        Este campo es <strong>obligatorio.</strong>
                    </mat-error>
                    <mat-error *ngIf="formEmail.email.errors && formEmail.email.errors.email">
                        Introduce un email válido
                    </mat-error>
                </mat-form-field>
                <!--Submit-->
                <button type="submit" class="btn btn-primary ml-2">Confirmar</button>
                <!--Cancelar-->
                <button type="button" class="btn btn-outline-primary ml-2"
                    (click)="enableDisableUpdateEmail(2)">Cancelar</button>
            </form>

            <!--Formulario contraseña-->
            <form *ngIf="enabledPass" [formGroup]="pass" (ngSubmit)="updatePass()" class="mt-4">
                <!--Password-->
                <mat-form-field appearance="outline" class="w-25 pr-1">
                    <mat-label class="gris">Crea una contraseña</mat-label>
                    <input matInput [type]="hide1 ? 'password' : 'text'" formControlName="password">
                    <button type="button" mat-icon-button matSuffix (click)="hide1 = !hide1"
                        [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide1">
                        <mat-icon>{{hide1 ? 'visibility_off' : 'visibility'}}</mat-icon>
                    </button>
                    <!--Validación contraseña-->
                    <mat-error *ngIf="formPass.password.errors && formPass.password.errors.required">
                        Este campo es <strong>obligatorio.</strong>
                    </mat-error>
                    <mat-error *ngIf="formPass.password.errors && formPass.password.errors.minlength">
                        La contraseña debe tener como mínimo
                        <strong>{{formPass.password.errors.minlength.requiredLength}} carácteres.</strong>
                    </mat-error>
                </mat-form-field>
                <!--Confirmación Password-->
                <mat-form-field appearance="outline" class="w-25 pl-1">
                    <mat-label class="gris">Repite la contraseña</mat-label>
                    <input matInput [type]="hide2 ? 'password' : 'text'" formControlName="confirmPassword"
                        pattern="{{pass.value.password}}">
                    <button type="button" mat-icon-button matSuffix (click)="hide2 = !hide2"
                        [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide2">
                        <mat-icon>{{hide2 ? 'visibility_off' : 'visibility'}}</mat-icon>
                    </button>
                    <!--Validación confirmación contraseña-->
                    <mat-error *ngIf="formPass.confirmPassword.errors && formPass.confirmPassword.errors.required">
                        Este campo es <strong>obligatorio.</strong>
                    </mat-error>
                    <mat-error *ngIf="formPass.confirmPassword.errors && formPass.confirmPassword.errors.pattern">
                        La contraseñas <strong>no coinciden</strong>
                    </mat-error>
                </mat-form-field>
                <!--Submit-->
                <button type="submit" class="btn btn-primary ml-2">
                    Confirmar
                </button>
                <!--Cancelar-->
                <button type="button" class="btn btn-outline-primary ml-2" (click)="enableDisableUpdatePass(2)">
                    Cancelar
                </button>
            </form>
        </div>

        <!--Mis items-->
        <div *ngIf="auth.itemsLogedUser.length > 0" class="col-12 mx-auto mt-4 py-3 px-4 rounded">
           <h3 class="text-white text-center">Inventario</h3>
            <div class="d-flex justify-content-center mt-3 px-5">
                <div *ngFor="let item of auth.itemsLogedUser" style="max-width: 300px;">
                    <div class="bg-success rounded px-2 py-2 ml-2">
                        <a routerLink="/tienda"><img src="{{item.img}}" height="120px" class="rounded w-100"></a>
                        <h5 class="text-white mt-1 text-center">{{item.name}}</h5>
                        <span class="d-flex justify-content-end">{{item.obtainedDate}}</span>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>